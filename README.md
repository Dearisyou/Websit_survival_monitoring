# 网站存活监控系统

一个现代化的Web页面存活监控应用，支持多用户管理、实时监控、钉钉告警等功能。

## 🚀 功能特性

### 核心功能
- ✅ **用户管理** - 管理员登录系统，多用户权限划分
- ✅ **网站监控** - 实时监控网站状态，响应时间统计
- ✅ **告警通知** - 钉钉机器人告警，故障和恢复通知
- ✅ **数据管理** - 监控日志记录，Excel批量导入
- ✅ **现代界面** - Bootstrap 5响应式设计

### 安全特性
- 🔒 **CSRF保护** - 防止跨站请求伪造
- 🛡️ **SSRF防护** - 防止服务器端请求伪造
- 🔐 **数据加密** - 敏感信息加密存储
- 📝 **审计日志** - 完整的操作记录
- ⚡ **速率限制** - 防止暴力破解和DoS攻击
- 🔑 **随机密码** - 自动生成安全密码

## 🚀 快速开始

### 1. 环境准备
```bash
# 克隆项目
git clone <项目地址>
cd 网站存活探测

# 安装依赖
pip install -r requirements.txt
```

### 2. 启动应用
```bash
# 直接启动
python run.py

# 或使用脚本
start.bat  # Windows
```

### 3. 访问系统
- 地址：http://localhost:5000
- 默认账号：**admin**
- 默认密码：查看 `admin_password.txt` 文件

> ⚠️ **重要**：首次登录后请立即修改默认密码！

## 📚 使用说明

### 👥 用户管理
- **角色分级**：管理员和普通用户
- **权限控制**：普通用户只能管理自己的监控项目
- **安全管理**：密码修改、登录日志记录

### 🔍 网站监控
- **批量添加**：支持Excel文件批量导入
- **灵活配置**：自定义检查间隔和超时时间
- **实时监控**：自动检查网站状态和响应时间
- **历史记录**：完整的监控日志和统计数据

### 🔔 告警通知
- **全局配置**：一次配置，所有网站共用
- **智能告警**：故障和恢复都会发送通知
- **灵活控制**：可单独关闭某个网站的告警
- **多种验证**：支持关键词和签名两种方式

### 钉钉机器人配置步骤
1. 在钉钉群中添加自定义机器人
2. 选择"自定义关键词"安全设置
3. 添加关键词"网站监控告警"
4. 复制Webhook地址到系统中

## 🛠️ 技术栈

### 后端技术
- **Web框架**: Flask 2.3.3
- **数据库**: SQLAlchemy + SQLite
- **任务调度**: APScheduler
- **表单处理**: Flask-WTF + WTForms
- **用户认证**: Flask-Login
- **HTTP请求**: Requests
- **数据处理**: Pandas + OpenPyXL

### 前端技术
- **UI框架**: Bootstrap 5.3
- **图标**: Bootstrap Icons
- **样式**: CSS3 + 渐变效果
- **交互**: JavaScript ES6

### 安全特性
- **CSRF保护**: Flask-WTF
- **数据加密**: Base64 + 自定义加密
- **速率限制**: 内存存储
- **审计日志**: Python Logging
- **SSRF防护**: URL解析验证

## 项目结构

```
网站存活探测/
├── app/
│   ├── __init__.py          # 应用初始化
│   ├── models.py            # 数据库模型
│   ├── forms.py             # 表单验证
│   ├── monitor.py           # 监控核心功能
│   ├── routes/              # 路由模块
│   │   ├── auth.py          # 认证相关路由
│   │   └── main.py          # 主要功能路由
│   └── templates/           # HTML模板
│       ├── base.html        # 基础模板
│       ├── auth/            # 认证相关模板
│       └── main/            # 主要功能模板
├── requirements.txt         # 依赖包列表
├── run.py                  # 应用启动文件
├── start.bat               # Windows启动脚本
└── README.md               # 项目说明
```

## ⚠️ 重要提示

### 安全配置
- 🔑 **首次登录**：查看 `admin_password.txt` 获取随机密码
- 🔐 **密码修改**：登录后立即修改默认密码
- 🔒 **环境变量**：生产环境设置 `SECRET_KEY`
- 🛡️ **HTTPS部署**：生产环境建议使用SSL证书

### 运行维护
- 💾 **数据备份**：定期备份 `monitor.db` 文件
- 📝 **日志监控**：检查 `audit.log` 和应用日志
- ⚡ **性能监控**：定期清理旧日志数据
- 🔄 **自动恢复**：监控任务重启后自动恢复

### 部署建议
- 📄 **详细文档**：查看 `DEPLOYMENT.md`
- 🔍 **环境诊断**：运行 `python production_fix.py`
- 🛠️ **故障排查**：查看 `SECURITY.md` 安全指南

## 许可证

MIT License